# $FreeBSD$

PORTNAME=	yori
PORTVERSION=	0.2.0
CATEGORIES=	net security python
MASTER_SITES=	https://github.com/apathy-ca/${PORTNAME}/releases/download/v${PORTVERSION}/

MAINTAINER=	jamesrahenry@henrynet.ca
COMMENT=	Zero-trust LLM governance for home networks

LICENSE=	MIT

BUILD_DEPENDS=	${PYTHON_PKGNAMEPREFIX}maturin>=1.0:devel/py-maturin@${PY_FLAVOR}
RUN_DEPENDS=	${PYTHON_PKGNAMEPREFIX}sqlite3>0:databases/py-sqlite3@${PY_FLAVOR} \
		${PYTHON_PKGNAMEPREFIX}fastapi>=0.109.0:www/py-fastapi@${PY_FLAVOR} \
		${PYTHON_PKGNAMEPREFIX}uvicorn>=0.27.0:www/py-uvicorn@${PY_FLAVOR} \
		${PYTHON_PKGNAMEPREFIX}httpx>=0.26.0:www/py-httpx@${PY_FLAVOR} \
		${PYTHON_PKGNAMEPREFIX}pydantic>=2.5.0:devel/py-pydantic@${PY_FLAVOR} \
		${PYTHON_PKGNAMEPREFIX}yaml>=6.0:devel/py-yaml@${PY_FLAVOR} \
		${PYTHON_PKGNAMEPREFIX}aiosqlite>=0.19.0:databases/py-aiosqlite@${PY_FLAVOR}

USES=		python:3.11+ cargo
USE_PYTHON=	autoplist concurrent distutils
USE_RC_SUBR=	yori

CARGO_CRATES=	# Generated by make cargo-crates

PLIST_FILES=	"@sample etc/yori/yori.conf.sample" \
		etc/rc.d/yori

post-install:
	${MKDIR} ${STAGEDIR}${PREFIX}/etc/yori/policies
	${MKDIR} ${STAGEDIR}/var/db/yori
	${MKDIR} ${STAGEDIR}/var/log/yori
	${INSTALL_DATA} ${WRKSRC}/examples/yori.conf.example \
		${STAGEDIR}${PREFIX}/etc/yori/yori.conf.sample

.include <bsd.port.mk>
